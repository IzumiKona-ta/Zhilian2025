# 测试接口使用说明（后端测试用）

## 快速开始

### 1. 启动服务（需要两个终端）

**终端1：启动告警网关（端口5000）**
```bash
python alert_gateway/alert_api.py
```

**终端2：启动测试接口（端口5001）**
```bash
python alert_gateway/test_api.py
```

### 2. 快速测试（推荐）

使用测试脚本一键测试所有功能：

```bash
python alert_gateway/test_api_local.py
```

测试脚本会自动：
- ✅ 检查测试接口健康状态
- ✅ 生成单条告警数据
- ✅ 发送单条告警到网关
- ✅ 批量发送10条告警
- ✅ 检查告警网关的告警数量
- ✅ 显示统计信息

### 3. 接口地址

- **测试接口**: `http://127.0.0.1:5001`
- **告警网关**: `http://127.0.0.1:5000`
- **告警仪表板**: `http://127.0.0.1:5000/dashboard`

## API接口

### 批量测试（推荐）

```bash
POST http://127.0.0.1:5001/test/batch
Content-Type: application/json

{
  "count": 100,
  "known_ratio": 0.6
}
```

**参数说明：**
- `count`: 告警数量（默认10）
- `known_ratio`: 已知攻击比例 0-1（默认0.6，即60%已知，40%未知）

### 发送单条告警

```bash
POST http://127.0.0.1:5001/test/send
Content-Type: application/json

{
  "attack_type": "DDoS",
  "severity": 5,
  "confidence": 0.95
}
```

### 生成告警（不发送，仅返回JSON）

```bash
GET http://127.0.0.1:5001/test/generate?is_known=true&severity=5
```

## Python代码示例

```python
import requests

# 批量测试（推荐）- 发送100条告警
response = requests.post(
    "http://127.0.0.1:5001/test/batch",
    json={"count": 100, "known_ratio": 0.6}
)
result = response.json()
print(f"成功: {result['results']['success']} 条")

# 发送单条告警
response = requests.post(
    "http://127.0.0.1:5001/test/send",
    json={"attack_type": "DDoS", "severity": 5, "confidence": 0.95}
)
print(response.json())

# 查看告警列表
response = requests.get("http://127.0.0.1:5000/alerts")
print(f"总告警数: {response.json()['total']}")
```

## 重要说明

| 接口 | 功能 | 是否发送到网关 |
|------|------|----------------|
| `/test/generate` | 生成告警数据 | ❌ 否（仅返回JSON） |
| `/test/send` | 发送单条告警 | ✅ 是 |
| `/test/batch` | 批量发送告警 | ✅ 是 |

**注意**：测试后端功能请使用 `/test/send` 或 `/test/batch`，不要用 `/test/generate`。

## 常见问题

1. **端口被占用**：关闭占用端口的程序
2. **无法连接**：确保两个服务都已启动
3. **仪表板显示0条**：确保使用 `/test/send` 或 `/test/batch`，不是 `/test/generate`

